<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Forex Confluence Dashboard</title>
<link rel="stylesheet" href="/static/style.css">
</head>
<body>

<h1>Forex Confluence Dashboard</h1>

<div class="filters">
  <button onclick="filterConfluence('All')">All</button>
  <button onclick="filterConfluence('Strong Bullish')">Strong Bullish</button>
  <button onclick="filterConfluence('Strong Bearish')">Strong Bearish</button>
  <button onclick="filterConfluence('No Confluence')">No Confluence</button>
</div>

<div id="cards-container" class="grid-container">
  <!-- Cards injected here -->
</div>

<script>
const API_URL = "/confluence";
let allData = [];

function mapTrendClass(trendText) {
  if (!trendText) return '';
  if (trendText.includes('Strong Bullish')) return 'Strong-Bullish';
  if (trendText.includes('Bullish')) return 'Bullish';
  if (trendText.includes('Strong Bearish')) return 'Strong-Bearish';
  if (trendText.includes('Bearish')) return 'Bearish';
  return '';
}

async function loadConfluence() {
  const res = await fetch(API_URL);
  const data = await res.json();
  allData = data;
  renderCards(data);
}

function renderCards(data) {
  const container = document.getElementById('cards-container');
  container.innerHTML = '';

  data.forEach(pairData => {
    const card = document.createElement('div');
    card.className = 'card Dark';

    let bars = '';
    for (const tf of ['Weekly','Daily','H4','H1']) {
      const trend = pairData.Confluence[tf] || '';
      bars += `<div class="trend-bar ${mapTrendClass(trend)}" title="${tf}: ${trend}"></div>`;
    }

    card.innerHTML = `
      <h2 class="pair-title">${pairData.Pair}</h2>
      <div class="trend-bars">${bars}</div>
      <div class="confluence-percent">${pairData.ConfluencePercent}%</div>
    `;
    container.appendChild(card);
  });
}

function filterConfluence(filter) {
  if(filter === "All") renderCards(allData);
  else {
    const filtered = allData.filter(d => d.Summary.includes(filter));
    renderCards(filtered);
  }
}

loadConfluence();
</script>
</body>
</html>
