<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Forex Confluence Dashboard</title>
<style>
body { font-family: Arial, sans-serif; background: #1e1e2f; color: #eee; margin: 0; padding: 0;}
.container { padding: 20px; }
button { margin: 5px; padding: 10px; border: none; border-radius: 5px; background: #444; color: #fff; cursor: pointer; }
button:hover { background: #666; }
table { width: 100%; border-collapse: collapse; margin-top: 20px; }
th, td { padding: 10px; text-align: center; border-bottom: 1px solid #555; }
th { background: #333; }
tr:hover { background: #2a2a3d; }
.sparkline { width: 100px; height: 20px; }
</style>
</head>
<body>
<div class="container">
<h1>Forex Confluence Dashboard</h1>
<div>
<button onclick="filterCategory('All')">All</button>
<button onclick="filterCategory('Majors')">Majors</button>
<button onclick="filterCategory('Minors')">Minors</button>
<button onclick="filterCategory('Exotics')">Exotics</button>
<button onclick="filterCategory('Commodities')">Gold</button>
<button onclick="filterCategory('Indices')">Indices</button>
</div>
<table>
<thead>
<tr>
<th>Pair</th>
<th>Category</th>
<th>Weekly</th>
<th>Daily</th>
<th>H4</th>
<th>H1</th>
<th>% Confluence</th>
<th>Chart</th>
</tr>
</thead>
<tbody id="table-body">
</tbody>
</table>
</div>
<script>
async function loadData() {
    const res = await fetch('/confluence');
    const data = await res.json();
    const tbody = document.getElementById('table-body');
    tbody.innerHTML = '';
    data.forEach(item => {
        const row = document.createElement('tr');
        row.dataset.category = item.category;
        row.innerHTML = `
            <td>${item.pair}</td>
            <td>${item.category}</td>
            <td>${item.trends.weekly || '—'}</td>
            <td>${item.trends.daily || '—'}</td>
            <td>${item.trends.h4 || '—'}</td>
            <td>${item.trends.h1 || '—'}</td>
            <td>${item.confluence_percent}%</td>
            <td>${item.chart ? `<img class="sparkline" src="${item.chart}">` : '—'}</td>
        `;
        tbody.appendChild(row);
    });
}

// Filters
function filterCategory(cat) {
    const rows = document.querySelectorAll('tbody tr');
    rows.forEach(r => {
        r.style.display = cat === 'All' || r.dataset.category === cat ? '' : 'none';
    });
}

// Auto-refresh every 60 seconds
loadData();
setInterval(loadData, 60000);
</script>
</body>
</html>
